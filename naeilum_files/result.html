<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Your Korean Name | Naeilum</title>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<style>
body {
  font-family: Pretendard, sans-serif;
  text-align: center;
  margin: 60px;
  background: #fafafa;
}
h2 { color: #333; margin-bottom: 8px; }
p.subtitle {
  color: #777;
  font-size: 15px;
  margin-bottom: 40px;
}
.result-container {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin-top: 20px;
  flex-wrap: wrap;
}
.card {
  width: 220px;
  border: 1px solid #ccc;
  border-radius: 12px;
  background: #fff;
  padding: 20px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  text-align: center;
  transition: transform 0.2s;
  cursor: pointer;
}
.card:hover { transform: translateY(-5px); }
.card h3 { font-size: 22px; color: #333; margin-bottom: 5px; }
.card p { margin: 4px 0; color: #555; }
.card .meaning { color: #4CAF50; font-weight: 600; }
button {
  margin-top: 40px;
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background-color: #45a049;
}
</style>
</head>
<body>

<h2>âœ¨ Your Korean Name Recommendations âœ¨</h2>
<p class="subtitle">Click your favorite name to check todayâ€™s fortune âœ¨</p>

<div id="results" class="result-container">â³ Loading results...</div>
<button onclick="goBack()">â† Choose Meaning Again</button>

<script>
// âœ… URL íŒŒë¼ë¯¸í„° ì½ê¸°
const params = new URLSearchParams(window.location.search);
const fullName = params.get("name")?.trim() || "";
const gender = params.get("gender") || "female";
const category = params.get("category")?.trim() || "";

// âœ… First name ì²« ê¸€ìë§Œ ì‚¬ìš©
const firstName = fullName.split(" ")[0] || fullName;
const firstLetter = firstName[0]?.toUpperCase() || "A";

// âœ… CSV íŒŒì¼ ê²°ì •
const csvFile = gender === "male" ? "male_names.csv" : "female_names.csv";

// âœ… CSV ë¶ˆëŸ¬ì˜¤ê¸°
fetch(csvFile)
  .then(res => res.text())
  .then(text => {
    const rows = text.split("\n").slice(1);
    const data = rows.map(line => {
      const [name, hanja, cat, meaning, initial] = line.split(",");
      return {
        name: name?.trim(),
        hanja: hanja?.trim(),
        category: cat?.trim(),
        meaning: meaning?.trim(),
        initial: initial?.trim()
      };
    }).filter(r => r.name && r.category);

    // âœ… 1ë‹¨ê³„: categoryë¡œ í•„í„°ë§
    const categoryFiltered = data.filter(r => r.category.toLowerCase() === category.toLowerCase());

    // âœ… 2ë‹¨ê³„: ì´ˆì„±(initial)ìœ¼ë¡œ í•„í„°ë§
    let initialFiltered = categoryFiltered.filter(r => r.initial === firstLetter);

    // âœ… fallback: ì´ˆì„± ì—†ìœ¼ë©´ category ë‚´ì—ì„œ ëœë¤ 3ê°œ
    let finalList = [];
    if (initialFiltered.length >= 3) {
      finalList = initialFiltered.sort(() => 0.5 - Math.random()).slice(0, 3);
    } else if (categoryFiltered.length >= 3) {
      finalList = categoryFiltered.sort(() => 0.5 - Math.random()).slice(0, 3);
    } else {
      finalList = data.sort(() => 0.5 - Math.random()).slice(0, 3);
    }

    // âœ… HTML ë Œë”ë§ (category ìˆ¨ê¹€)
    const html = finalList.map(r => `
      <div class="card" onclick="checkFortune('${r.name}')">
        <h3>${r.name}</h3>
        <p>${r.hanja}</p>
        <p class="meaning">${r.meaning}</p>
      </div>
    `).join("");

    document.getElementById("results").innerHTML = html || "<p>No matching results found.</p>";
  })
  .catch(err => {
    console.error(err);
    document.getElementById("results").innerHTML = "<p>âš ï¸ Error loading data.</p>";
  });

// âœ… ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼
function goBack() {
  window.history.back();
}

// âœ… ì´ë¦„ í´ë¦­ ì‹œ ìš´ì„¸ í˜ì´ì§€ë¡œ ì´ë™ (ì„ì‹œ)
function checkFortune(name) {
  alert(`ğŸ”® Checking today's fortune for ${name}...`);
  // í–¥í›„ ì—°ê²°: window.location.href = `fortune.html?name=${encodeURIComponent(name)}`;
}
</script>

</body>
</html>

